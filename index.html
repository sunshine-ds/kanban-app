<!doctype html>
<html lang="en" class="antialiased">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FlowBoard — Kanban + Idea Board with Themes</title>
  <meta name="description" content="A responsive Kanban + Idea board with light/dark themes and persistent storage." />

  <!-- Tailwind CDN + config (dark mode by class) -->
  <script>
    window.tailwind = { config: { darkMode: 'class', theme: { extend: { colors: { 'brand': '#5b21b6' } } } } };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* Small helper for scroll shadow */
    .scroll-x::-webkit-scrollbar { height: 10px; }
    .scroll-x::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.2); border-radius: 999px; }
  </style>
</head>
<body class="min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-100 transition-colors duration-200">
  <div class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
    <!-- Header -->
    <header class="flex items-center justify-between gap-4">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-brand to-purple-500 flex items-center justify-center shadow-lg text-white text-lg font-semibold">FB</div>
        <div>
          <h1 class="text-xl sm:text-2xl font-semibold tracking-tight">FlowBoard</h1>
          <p class="text-sm text-gray-600 dark:text-gray-400">Kanban & Idea board — light/dark themes, drag & drop, persistent storage</p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <!-- Board selector -->
        <div class="relative">
          <select id="boardSelect" class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-sm py-2 px-3 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-brand">
            <!-- populated by JS -->
          </select>
        </div>

        <!-- New board button (quick) -->
        <button id="newBoardBtn" class="inline-flex items-center gap-2 px-3 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md text-sm shadow hover:shadow-md transition">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-brand" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
          New Board
        </button>

        <!-- Theme toggle -->
        <button id="themeToggle" aria-label="Toggle theme" class="p-2 rounded-md bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow hover:shadow-md transition">
          <svg id="themeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500" viewBox="0 0 20 20" fill="currentColor"><path d="M10 2a.75.75 0 01.75.75V4.5a.75.75 0 01-1.5 0V2.75A.75.75 0 0110 2zM10 15.5a4.5 4.5 0 100-9 4.5 4.5 0 000 9zM3.22 4.22a.75.75 0 011.06 0l1.06 1.06a.75.75 0 11-1.06 1.06L3.22 5.28a.75.75 0 010-1.06zM15.66 14.66a.75.75 0 011.06 0l1.06 1.06a.75.75 0 11-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM2 10a.75.75 0 01.75-.75H4.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm13.5 0a.75.75 0 01.75-.75h1.75a.75.75 0 010 1.5H16.25a.75.75 0 01-.75-.75zM3.22 15.78a.75.75 0 010-1.06l1.06-1.06a.75.75 0 111.06 1.06L4.28 15.78a.75.75 0 01-1.06 0zM15.66 5.34a.75.75 0 010-1.06l1.06-1.06a.75.75 0 111.06 1.06L16.72 5.34a.75.75 0 01-1.06 0z"/></svg>
        </button>
      </div>
    </header>

    <!-- Main app area -->
    <main class="mt-6">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-3">
          <h2 id="boardTitle" class="text-lg font-medium">Board</h2>
          <span id="boardDesc" class="text-sm text-gray-500 dark:text-gray-400">Manage tasks and ideas</span>
        </div>

        <div class="flex items-center gap-2">
          <input id="search" type="search" placeholder="Search cards..." class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm focus:outline-none" />
          <button id="clearBoard" class="px-3 py-2 bg-red-50 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded-md border border-red-100 dark:border-red-700 text-sm hover:opacity-90">Clear</button>
          <button id="exportBoard" class="px-3 py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-md text-sm">Export</button>
        </div>
      </div>

      <!-- Columns area (scrollable on small screens) -->
      <div id="boardArea" class="flex gap-4 overflow-x-auto scroll-x py-2 pb-6">
        <!-- columns rendered by JS -->
      </div>

      <p class="mt-4 text-xs text-gray-500 dark:text-gray-400">Tip: Drag cards between columns. Changes are saved automatically in your browser.</p>
    </main>

    <!-- Edit / Create Modal -->
    <div id="modal" class="fixed inset-0 z-40 hidden items-center justify-center bg-black/40">
      <div class="w-full max-w-2xl bg-white dark:bg-gray-800 rounded-xl shadow-xl p-6">
        <div class="flex items-center justify-between">
          <h3 id="modalTitle" class="text-lg font-semibold">Edit card</h3>
          <button id="closeModal" class="text-gray-500 hover:text-gray-700 dark:text-gray-300">Close</button>
        </div>
        <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label class="text-sm text-gray-600 dark:text-gray-400">Title</label>
            <input id="cardTitleInput" class="mt-1 w-full px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900" />
          </div>
          <div>
            <label class="text-sm text-gray-600 dark:text-gray-400">Tag</label>
            <input id="cardTagInput" class="mt-1 w-full px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900" placeholder="e.g. idea, bug, research" />
          </div>
          <div class="sm:col-span-2">
            <label class="text-sm text-gray-600 dark:text-gray-400">Details</label>
            <textarea id="cardDetailInput" rows="4" class="mt-1 w-full px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900"></textarea>
          </div>
        </div>
        <div class="mt-4 flex items-center justify-end gap-2">
          <button id="deleteCardBtn" class="px-3 py-2 bg-red-50 dark:bg-red-900/30 text-red-600 rounded-md border border-red-100 dark:border-red-700 text-sm">Delete</button>
          <button id="saveCardBtn" class="px-4 py-2 bg-brand text-white rounded-md shadow-sm">Save</button>
        </div>
      </div>
    </div>

    <!-- Hidden template for column (for accessibility / fallback) -->
    <template id="columnTemplate">
      <section class="min-w-[280px] max-w-sm bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm border border-gray-100 dark:border-gray-700">
        <div class="flex items-center justify-between mb-3">
          <h3 class="font-semibold">Column</h3>
          <div class="flex items-center gap-2">
            <button class="inline-flex items-center gap-2 px-2 py-1 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded text-xs">Add</button>
            <button class="inline-flex items-center justify-center w-8 h-8 rounded-md text-sm text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700">⋮</button>
          </div>
        </div>
        <div class="mb-3">
          <input class="addCardInput w-full px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900 text-sm" placeholder="Add a card and press Enter" />
        </div>
        <div class="space-y-3 columnDrop" aria-live="polite"></div>
      </section>
    </template>

  </div>

  <script>
    /* ---------- App Data & Utilities ---------- */
    const STORAGE_KEY = 'flowboard_v1';

    // Default boards: one project board + the requested Idea Board
    const defaultBoards = [
      {
        id: idGen(),
        title: 'Project Board',
        description: 'Track tasks and progress',
        columns: [
          { id: idGen(), title: 'Backlog', cards: [ { id: idGen(), title: 'Plan roadmap', tag: 'planning', detail: 'Define milestones for Q3' } ] },
          { id: idGen(), title: 'In Progress', cards: [ { id: idGen(), title: 'Design landing', tag: 'design', detail: 'Hero section & CTA' } ] },
          { id: idGen(), title: 'Done', cards: [ { id: idGen(), title: 'Setup repo', tag: 'devops', detail: 'Initialize GitHub repository' } ] }
        ]
      },

      // The new Idea Board requested in the brief
      {
        id: idGen(),
        title: 'Idea Board',
        description: 'Capture ideas, research and prototypes',
        columns: [
          { id: idGen(), title: 'Ideas', cards: [ { id: idGen(), title: 'Smart tags for notes', tag: 'idea', detail: 'Auto-suggest tags based on content' }, { id: idGen(), title: 'Offline sync', tag: 'idea', detail: 'PWA-like offline support' } ] },
          { id: idGen(), title: 'Research', cards: [ { id: idGen(), title: 'Market fit survey', tag: 'research', detail: 'Create short user survey for target segment' } ] },
          { id: idGen(), title: 'Prototype', cards: [] }
        ]
      }
    ];

    let app = { boards: [], currentBoardId: null };

    // Simple id generator
    function idGen() { return 'id-' + Math.random().toString(36).slice(2, 9); }

    function load() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          app = JSON.parse(raw);
        } else {
          app = { boards: defaultBoards, currentBoardId: defaultBoards[0].id };
          save();
        }
      } catch (e) {
        console.error('Failed to load storage', e);
        app = { boards: defaultBoards, currentBoardId: defaultBoards[0].id };
        save();
      }
    }

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(app)); }

    /* ---------- Theme Handling ---------- */
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const htmlEl = document.documentElement;

    function applyTheme(theme) {
      if (theme === 'dark') htmlEl.classList.add('dark'); else htmlEl.classList.remove('dark');
      localStorage.setItem('flowboard_theme', theme);
      updateThemeIcon(theme);
    }

    function updateThemeIcon(theme) {
      // swap icon color & path quickly
      if (theme === 'dark') {
        themeIcon.innerHTML = '<path d="M17.293 13.293A8 8 0 118.707 4.707 6 6 0 1017.293 13.293z"/>';
      } else {
        themeIcon.innerHTML = '<path d="M10 2a.75.75 0 01.75.75V4.5a.75.75 0 01-1.5 0V2.75A.75.75 0 0110 2zM10 15.5a4.5 4.5 0 100-9 4.5 4.5 0 000 9zM3.22 4.22a.75.75 0 011.06 0l1.06 1.06a.75.75 0 11-1.06 1.06L3.22 5.28a.75.75 0 010-1.06zM15.66 14.66a.75.75 0 011.06 0l1.06 1.06a.75.75 0 11-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zM2 10a.75.75 0 01.75-.75H4.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10zm13.5 0a.75.75 0 01.75-.75h1.75a.75.75 0 010 1.5H16.25a.75.75 0 01-.75-.75zM3.22 15.78a.75.75 0 010-1.06l1.06-1.06a.75.75 0 111.06 1.06L4.28 15.78a.75.75 0 01-1.06 0zM15.66 5.34a.75.75 0 010-1.06l1.06-1.06a.75.75 0 111.06 1.06L16.72 5.34a.75.75 0 01-1.06 0z"/>';
      }
    }

    themeToggle.addEventListener('click', () => {
      const current = localStorage.getItem('flowboard_theme') || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      applyTheme(current === 'dark' ? 'light' : 'dark');
    });

    // Initialize theme on load
    (function initTheme() {
      const saved = localStorage.getItem('flowboard_theme');
      const defaultTheme = saved || (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      applyTheme(defaultTheme);
    })();

    /* ---------- DOM References ---------- */
    const boardSelect = document.getElementById('boardSelect');
    const boardTitle = document.getElementById('boardTitle');
    const boardDesc = document.getElementById('boardDesc');
    const boardArea = document.getElementById('boardArea');
    const columnTemplate = document.getElementById('columnTemplate');
    const newBoardBtn = document.getElementById('newBoardBtn');
    const searchInput = document.getElementById('search');
    const clearBoardBtn = document.getElementById('clearBoard');
    const exportBoardBtn = document.getElementById('exportBoard');

    // Modal
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const modalTitle = document.getElementById('modalTitle');
    const cardTitleInput = document.getElementById('cardTitleInput');
    const cardTagInput = document.getElementById('cardTagInput');
    const cardDetailInput = document.getElementById('cardDetailInput');
    const saveCardBtn = document.getElementById('saveCardBtn');
    const deleteCardBtn = document.getElementById('deleteCardBtn');

    let editing = { boardId: null, columnId: null, cardId: null };

    /* ---------- Rendering ---------- */
    function renderBoardsList() {
      boardSelect.innerHTML = '';
      app.boards.forEach(b => {
        const opt = document.createElement('option');
        opt.value = b.id;
        opt.textContent = b.title;
        boardSelect.appendChild(opt);
      });
      boardSelect.value = app.currentBoardId;
    }

    function render() {
      renderBoardsList();
      const board = app.boards.find(b => b.id === app.currentBoardId) || app.boards[0];
      if (!board) return;
      boardTitle.textContent = board.title;
      boardDesc.textContent = board.description || '';

      boardArea.innerHTML = '';
      board.columns.forEach(col => {
        const node = columnTemplate.content.cloneNode(true);
        const sec = node.querySelector('section');
        sec.dataset.colId = col.id;
        sec.querySelector('h3').textContent = `${col.title} (${col.cards.length})`;
        const addInput = sec.querySelector('.addCardInput');
        const columnDrop = sec.querySelector('.columnDrop');
        addInput.addEventListener('keydown', e => {
          if (e.key === 'Enter' && addInput.value.trim()) {
            const newCard = { id: idGen(), title: addInput.value.trim(), tag: '', detail: '' };
            col.cards.unshift(newCard);
            addInput.value = '';
            save(); render();
          }
        });

        // Drag & drop events on column
        columnDrop.addEventListener('dragover', e => { e.preventDefault(); sec.classList.add('ring-2', 'ring-brand', 'ring-opacity-40'); });
        columnDrop.addEventListener('dragleave', e => { sec.classList.remove('ring-2', 'ring-brand', 'ring-opacity-40'); });
        columnDrop.addEventListener('drop', e => {
          e.preventDefault(); sec.classList.remove('ring-2', 'ring-brand', 'ring-opacity-40');
          const cardId = e.dataTransfer.getData('text/card');
          const fromColId = e.dataTransfer.getData('text/fromCol');
          if (!cardId) return;
          moveCard(board.id, fromColId, col.id, cardId);
        });

        // Render cards
        col.cards.forEach(card => {
          const cardEl = document.createElement('article');
          cardEl.className = 'bg-gray-50 dark:bg-gray-900 border border-gray-100 dark:border-gray-700 rounded-md p-3 shadow-sm cursor-move';
          cardEl.draggable = true;
          cardEl.dataset.cardId = card.id;
          cardEl.innerHTML = `
            <div class=\"flex items-start justify-between gap-2\"> 
              <div class=\"min-w-0\"> 
                <h4 class=\"font-medium truncate\">${escapeHtml(card.title)}</h4>
                <p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate\">${escapeHtml(card.tag || '')}</p>
              </div>
              <div class=\"flex items-center gap-1\"> 
                <button class=\"text-xs text-gray-400 hover:text-gray-600 dark:hover:text-gray-200\" title=\"Edit\">✎</button>
              </div>
            </div>
          `;

          // Click to open edit modal
          cardEl.addEventListener('click', (ev) => {
            ev.stopPropagation();
            openEditModal(board.id, col.id, card.id);
          });

          // Drag events
          cardEl.addEventListener('dragstart', (ev) => {
            ev.dataTransfer.setData('text/card', card.id);
            ev.dataTransfer.setData('text/fromCol', col.id);
            ev.dataTransfer.effectAllowed = 'move';
            cardEl.classList.add('opacity-60');
          });
          cardEl.addEventListener('dragend', (ev) => { cardEl.classList.remove('opacity-60'); });

          columnDrop.appendChild(cardEl);
        });

        boardArea.appendChild(sec);
      });
    }

    function escapeHtml(str = '') {
      return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"})[s]);
    }

    /* ---------- Card Operations ---------- */
    function findBoard(boardId) { return app.boards.find(b => b.id === boardId); }

    function moveCard(boardId, fromColId, toColId, cardId) {
      const board = findBoard(boardId);
      if (!board) return;
      const fromCol = board.columns.find(c => c.id === fromColId);
      const toCol = board.columns.find(c => c.id === toColId);
      if (!fromCol || !toCol) return;
      const idx = fromCol.cards.findIndex(c => c.id === cardId);
      if (idx === -1) return;
      const [card] = fromCol.cards.splice(idx, 1);
      toCol.cards.unshift(card);
      save(); render();
    }

    function openEditModal(boardId, columnId, cardId) {
      const board = findBoard(boardId);
      const col = board.columns.find(c => c.id === columnId);
      const card = col.cards.find(c => c.id === cardId);
      editing = { boardId, columnId, cardId };
      modalTitle.textContent = 'Edit card';
      cardTitleInput.value = card.title || '';
      cardTagInput.value = card.tag || '';
      cardDetailInput.value = card.detail || '';
      deleteCardBtn.style.display = 'inline-block';
      modal.classList.remove('hidden');
      modal.classList.add('flex');
      cardTitleInput.focus();
    }

    function closeEditModal() { modal.classList.add('hidden'); modal.classList.remove('flex'); editing = { boardId: null, columnId: null, cardId: null }; }

    saveCardBtn.addEventListener('click', () => {
      const { boardId, columnId, cardId } = editing;
      if (!boardId) return closeEditModal();
      const board = findBoard(boardId);
      const col = board.columns.find(c => c.id === columnId);
      const card = col.cards.find(c => c.id === cardId);
      card.title = cardTitleInput.value.trim() || 'Untitled';
      card.tag = cardTagInput.value.trim();
      card.detail = cardDetailInput.value.trim();
      save(); render(); closeEditModal();
    });

    deleteCardBtn.addEventListener('click', () => {
      const { boardId, columnId, cardId } = editing;
      if (!boardId) return closeEditModal();
      const board = findBoard(boardId);
      const col = board.columns.find(c => c.id === columnId);
      col.cards = col.cards.filter(c => c.id !== cardId);
      save(); render(); closeEditModal();
    });

    closeModal.addEventListener('click', closeEditModal);
    modal.addEventListener('click', (e) => { if (e.target === modal) closeEditModal(); });

    /* ---------- Board CRUD ---------- */
    newBoardBtn.addEventListener('click', () => {
      const name = prompt('Board name (e.g. Marketing, Personal, Idea Board)');
      if (!name) return;
      const id = idGen();
      const newBoard = { id, title: name, description: '', columns: [ { id: idGen(), title: 'To Do', cards: [] }, { id: idGen(), title: 'In Progress', cards: [] }, { id: idGen(), title: 'Done', cards: [] } ] };
      app.boards.push(newBoard);
      app.currentBoardId = id;
      save(); render();
    });

    boardSelect.addEventListener('change', () => {
      app.currentBoardId = boardSelect.value;
      save(); render();
    });

    clearBoardBtn.addEventListener('click', () => {
      if (!confirm('Clear all cards from this board? This cannot be undone.')) return;
      const b = findBoard(app.currentBoardId);
      b.columns.forEach(c => c.cards = []);
      save(); render();
    });

    exportBoardBtn.addEventListener('click', () => {
      const b = findBoard(app.currentBoardId);
      const data = JSON.stringify(b, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = `${b.title.replace(/\s+/g,'-').toLowerCase() || 'board'}.json`;
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });

    /* ---------- Search ---------- */
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      if (!q) return render();
      const b = findBoard(app.currentBoardId);
      // Render only matching cards (quick client-side filter)
      boardTitle.textContent = `${b.title} — Search: "${q}"`;
      boardArea.innerHTML = '';
      b.columns.forEach(col => {
        const node = columnTemplate.content.cloneNode(true);
        const sec = node.querySelector('section');
        sec.querySelector('h3').textContent = `${col.title} (${col.cards.length})`;
        const addInput = sec.querySelector('.addCardInput');
        const columnDrop = sec.querySelector('.columnDrop');
        addInput.addEventListener('keydown', e => { if (e.key === 'Enter' && addInput.value.trim()) { col.cards.unshift({ id: idGen(), title: addInput.value.trim(), tag:'', detail: '' }); addInput.value=''; save(); render(); } });
        col.cards.filter(c => (c.title + ' ' + (c.detail||'') + ' ' + (c.tag||'')).toLowerCase().includes(q)).forEach(card => {
          const cardEl = document.createElement('article');
          cardEl.className = 'bg-gray-50 dark:bg-gray-900 border border-gray-100 dark:border-gray-700 rounded-md p-3 shadow-sm cursor-move';
          cardEl.innerHTML = `<div class=\"flex items-start justify-between gap-2\"><div class=\"min-w-0\"><h4 class=\"font-medium truncate\">${escapeHtml(card.title)}</h4><p class=\"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate\">${escapeHtml(card.tag || '')}</p></div></div>`;
          cardEl.addEventListener('click', () => openEditModal(b.id, col.id, card.id));
          columnDrop.appendChild(cardEl);
        });
        boardArea.appendChild(sec);
      });
    });

    /* ---------- Init ---------- */
    load();
    render();

    // Handle drag data for card move across columns
    // We already set data during dragstart; ensure drop targets exist on entire board area

    /* ---------- Utility: make data resilient on window unload ---------- */
    window.addEventListener('beforeunload', () => save());

  </script>
</body>
</html>
